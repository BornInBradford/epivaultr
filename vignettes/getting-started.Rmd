---
title: "Getting started with epivaultr"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting started with epivaultr}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
library(epivaultr)
```

`epivaultr` is an R package used to extract data from EpiVault, the Born in Bradford data warehouse. It can be used for quick grabs of specific variables from specific tables. It can also be used to manage an entire data request end to end, from reading a user's requested variables, to writing output files ready for shipping.

In this guide we will install `epivaultr`, connect to EpiVault, and do a quick extract of a couple of variables from a single table.

## Installation

[epivaultr](https://github.com/BornInBradford/epivaultr) can be installed from GitHub using the `devtools` package:

```{r eval=FALSE}
devtools::install_github("BornInBradford/epivaultr")
```

## Quick extract

The simple script below opens an EpiVault connection, extracts a couple of variables, and disconnects from EpiVault.

```{r eval=FALSE}

con <- ev_connect(ev_server = "BHTS-RESRCH22DV", ev_database = "ResearchWarehouse")

dat <- ev_simple_fetch(con, project = "BiB_CohortInfo", table = "ethnicity",
                       variables = c("ParticipantType", "ethsource"))

dat

```

## What if I need variables from a lot of tables?

The `ev_simple_fetch` function provides a convenient way to quickly grab a small number of variables. If, however, your project needs a large number of variables from across many tables, you may find it easier to maintain a variables list in a separate file and read the data in using this.

The script below reads a variable request specification from a spreadsheet and extracts the data into a single container called an `ev_data` container.

```{r eval=FALSE}

vars <- read_ev_variables("tests/example_inputs/variables.xlsx")
dat <- fetch_ev_data(con, vars)

# the data and metadata tables are now in an `ev_data` container called `dat`
dat

```

### Retrieving the data

The data in `dat` can be retrieved using the `epivaultr` *getter* functions.

#### Get the names of the data tables

```{r eval=FALSE}
get_ev_data_names(dat)
```

#### Get a data table

```{r eval=FALSE}
dat_table <- get_ev_data(dat, df_name = "proj1.tab1")
```

#### Get metadata

Various types of metadata can also be accessed from the `ev_data` container.

```{r eval=FALSE}
# get variable metadata
meta1 <- get_ev_metadata(dat, type = "variable")
# get category metadata
meta2 <- get_ev_metadata(dat, type = "category")
# get table metadata
meta3 <- get_ev_metadata(dat, type = "table")
```

For more information on retrieving data and metadata from the `ev_data` container, see the function Reference **[LINK??]**.





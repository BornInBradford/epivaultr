<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="epivaultr">
<title>Concepts and features • epivaultr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Concepts and features">
<meta property="og:description" content="epivaultr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary" data-bs-theme="dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">epivaultr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/getting-started.html">Getting started</a>
    <a class="dropdown-item" href="../articles/data-requests.html">Data requests</a>
    <a class="dropdown-item" href="../articles/features-concepts.html">Concepts and features</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Concepts and features</h1>
            
      
      
      <div class="d-none name"><code>features-concepts.Rmd</code></div>
    </div>

    
    
<p><a href="https://github.com/BornInBradford/epivaultr" class="external-link"><code>epivaultr</code></a>
is an R package used to extract data from EpiVault, the Born in Bradford
data warehouse. It can be used for quick grabs of specific variables
from specific tables. It can also be used to manage an entire data
request end to end, from reading a user’s requested variables, to
writing output files ready for shipping.</p>
<p>This guide explains various concepts and features employed by <a href="https://github.com/BornInBradford/epivaultr" class="external-link"><code>epivaultr</code></a>.</p>
<div class="section level2">
<h2 id="working-with-variables">Working with variables<a class="anchor" aria-label="anchor" href="#working-with-variables"></a>
</h2>
<div class="section level3">
<h3 id="variable-naming">Variable naming<a class="anchor" aria-label="anchor" href="#variable-naming"></a>
</h3>
<p>EpiVault organises data into projects, tables and variables with the
following properties:</p>
<ul>
<li>An instance of EpiVault contains projects.
<ul>
<li>Each project has a unique name <em>within its EpiVault
instance</em>
</li>
</ul>
</li>
<li>A project contains tables.
<ul>
<li>Each table has a unique name <em>within its project</em>.</li>
</ul>
</li>
<li>A table contains observations in rows and variables in columns. The
name of each column is the <em>variable name</em>.
<ul>
<li>Each variable has a unique name <em>within its table</em>.</li>
</ul>
</li>
</ul>
<p>As each variable has a unique name within its table, the <em>variable
name</em> can safely be used to refer to the variable within the context
of that table.</p>
<p>However, within the wider context of EpiVault, the <em>project
name</em> and <em>table name</em> are needed to uniquely refer to the
variable. We separate these with dots,
e.g. <code>project_name.table_name.variable_name</code> ande call this
the <em>fully qualified variable name</em>:</p>
<table class="table">
<colgroup>
<col width="38%">
<col width="38%">
<col width="23%">
</colgroup>
<thead><tr class="header">
<th>Reference type</th>
<th>Reference</th>
<th>Unique within</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><em>project name</em></td>
<td>BiB_CohortInfo</td>
<td>EpiVault</td>
</tr>
<tr class="even">
<td><em>table name</em></td>
<td>person_info</td>
<td>project (BiB_CohortInfo)</td>
</tr>
<tr class="odd">
<td><em>variable name</em></td>
<td>Gender</td>
<td>table (person_info)</td>
</tr>
<tr class="even">
<td><em>fully qualified variable name</em></td>
<td>BiB_CohortInfo.person_info.Gender</td>
<td>EpiVault</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="variable-file-formats">Variable file formats<a class="anchor" aria-label="anchor" href="#variable-file-formats"></a>
</h3>
<p>Most data requests and complex projects will start by reading a
variable list from a file using <code><a href="../reference/read_ev_variables.html">read_ev_variables()</a></code>.</p>
<p>Although simple data requests can be run directly in code by
selecting variables using <code><a href="../reference/make_ev_variables.html">make_ev_variables()</a></code> or doing a
quick table query using <code><a href="../reference/ev_simple_fetch.html">ev_simple_fetch()</a></code>, maintaining a
variables file is considered more reproducible and future-proof.</p>
<p><code><a href="../reference/read_ev_variables.html">read_ev_variables()</a></code> supports delimited text or MS Excel
formats, which can be in one of the following structures:</p>
<table class="table">
<thead><tr class="header">
<th>Format</th>
<th>Column 1</th>
<th>Column 2</th>
<th>Column 3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Single column</td>
<td>Fully qualified variable name</td>
<td><em>none</em></td>
<td><em>none</em></td>
</tr>
<tr class="even">
<td>Three columns</td>
<td>project name</td>
<td>table name</td>
<td>variable name</td>
</tr>
</tbody>
</table>
<p>A header row is optional and <code><a href="../reference/read_ev_variables.html">read_ev_variables()</a></code> will
skip over this if the column names are obvious,
e.g. <code>project</code>, <code>table</code>, <code>variable</code>,
<code>name</code> etc.</p>
<p>If <code><a href="../reference/read_ev_variables.html">read_ev_variables()</a></code> returns an empty result then it
may have encountered problems interpreting the structure. Try the
following:</p>
<ul>
<li>Remove the header row</li>
<li>Remove any blank rows that occur before the end of the file</li>
<li>Make sure there are exactly one or three columns</li>
<li>If there is one column, make sure this contains fully qualified
variable names</li>
<li>If there are three columns, make sure these are project, table and
variable <em>in that order</em>. For three-column text formats make sure
a recognised delimiter is used, e.g. a tab or a comma.</li>
</ul>
<p>If the file extension is <code>csv</code>, <code>txt</code>, or
<code>tsv</code>, it will try to read the file as a delimited text file,
e.g. comma- or tab-separated or fixed width. If it cannot determine the
delimiter it will try to read it line by line.</p>
<div class="section level4">
<h4 id="wildcards">Wildcards<a class="anchor" aria-label="anchor" href="#wildcards"></a>
</h4>
<p>Wildcards can be used in variable names to capture groups of
variables from a single table in one go. <code>?</code> matches a single
character and <code>*</code> matches any number of characters.
Currently, wildcards can only be used in variable names, not table or
project names.</p>
<table class="table">
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<tbody>
<tr class="odd">
<td><code>BiB_Baseline.base_m_survey.*</code></td>
<td>Returns all variables in the table BiB_Baseline_base_m_survey</td>
</tr>
<tr class="even">
<td><code>BiB_Baseline.base_m_survey.eth*</code></td>
<td>Returns all variables with the prefix <code>eth</code> in the table
BiB_Baseline_base_m_survey</td>
</tr>
<tr class="odd">
<td><code>BiB_Baseline.base_m_survey.agem?_mbqall</code></td>
<td>Returns <code>BiB_Baseline.base_m_survey.agemm_mbqall</code> and
<code>BiB_Baseline.base_m_survey.agemy_mbqall</code>
</td>
</tr>
<tr class="even">
<td><code>BiB_Baseline.base_?_survey.*</code></td>
<td>
<em>Not supported:</em> wildcards can only be used in the variable
name part</td>
</tr>
</tbody>
</table>
<p>Wildcards in the variable name will work in either one column or
three column variables file formats.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="variable-visibility">Variable visibility<a class="anchor" aria-label="anchor" href="#variable-visibility"></a>
</h2>
<p>Variable visibility is the concept used to manage fine-grained data
access permissions in EpiVault. Every variable has a visibility level
assigned in the variable metadata from 0 to 9. The visibility value
reflects the level of elevated privileges a user needs to be able to
access it. So:</p>
<table class="table">
<colgroup>
<col width="31%">
<col width="68%">
</colgroup>
<thead><tr class="header">
<th>variable visibility</th>
<th>meaning</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>All users can see this variable</td>
</tr>
<tr class="even">
<td>5</td>
<td>All users with a privilege level of 5 and above can see this
variable</td>
</tr>
<tr class="odd">
<td>9</td>
<td>Only users with the highest privilege level can see this
variable</td>
</tr>
</tbody>
</table>
<p>And, conversely:</p>
<table class="table">
<thead><tr class="header">
<th>user privilege level</th>
<th>meaning</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>Can only access variables with visibility level 0</td>
</tr>
<tr class="even">
<td>5</td>
<td>Can access all variables with visibility level 5 and below</td>
</tr>
<tr class="odd">
<td>9</td>
<td>Can access all variables</td>
</tr>
</tbody>
</table>
<p>For the most part, only visibility levels 0 and 9 are used. Variables
that any user can access are given visibility level 0. Sensitive
variables that only users with elevated privileges can access are given
visibility level 9.</p>
<p>When <a href="https://github.com/BornInBradford/epivaultr" class="external-link"><code>epivaultr</code></a>
queries EpiVault, i.e. via the <a href="https://borninbradford.github.io/epivaultr/reference/index.html#managing-data-requests">fetch_</a>
functions, a <code>visibility</code> parameter is required. This
defaults to 0, meaning it will only return variables that are visible to
all users. If you need to access a sensitive variable, e.g. date of
birth, you will need to assign a higher value to the
<code>visibility</code> parameter, probably 9. For this to work, your
user account will need certain elevated privileges to be assigned within
the EpiVault database.</p>
</div>
<div class="section level2">
<h2 id="required-columns">Required columns<a class="anchor" aria-label="anchor" href="#required-columns"></a>
</h2>
<p>A variable can be indicated as <em>required</em> in its metadata.
Whenever data from a table is queried, all required columns will be
returned, as well as those requested.</p>
<p>For many tables, the only required column will be a record id such as
a <code>person_id</code>. But often there may be other required
variables, such as additional row identifiers, or important dimensions
such as date or age.</p>
<p>If you need to check for required variables in a data request, you
can use <a href="https://borninbradford.github.io/epivaultr/reference/fetch_ev_meta_vars.html"><code>fetch_ev_meta_vars()</code></a>
to return the variable metadata and inspect the <code>required</code>
column (1=required). Alternatively, you can access the same variable
metadata from an <a href="https://borninbradford.github.io/epivaultr/articles/features-concepts.html#ev_data---the-data-extract"><code>ev_data</code></a>
container using <a href="https://borninbradford.github.io/epivaultr/reference/get_ev_metadata.html"><code>get_ev_metadata()</code></a>.</p>
</div>
<div class="section level2">
<h2 id="containers">Containers<a class="anchor" aria-label="anchor" href="#containers"></a>
</h2>
<p>A <em>container</em> in <a href="https://github.com/BornInBradford/epivaultr" class="external-link"><code>epivaultr</code></a>
is a collection of nested lists. They contain various data frames and
vectors that are bundled together for the convenience of being able to
pass them together to function calls. The contents can be accessed using
a set of <a href="https://borninbradford.github.io/epivaultr/reference/index.html#get-data-from-containers"><code>get_</code></a>
functions.</p>
<p>There are two main types of container:</p>
<table class="table">
<colgroup>
<col width="50%">
<col width="50%">
</colgroup>
<tbody>
<tr class="odd">
<td><a href="https://borninbradford.github.io/epivaultr/articles/features-concepts.html#ev_variables---the-data-request"><code>ev_variables</code></a></td>
<td>The data request: contains the variables requried for a data
request, with associated information</td>
</tr>
<tr class="even">
<td><a href="https://borninbradford.github.io/epivaultr/articles/features-concepts.html#ev_data---the-data-extract"><code>ev_data</code></a></td>
<td>The data extract: contains the data returned by a data request, with
associated metadata</td>
</tr>
</tbody>
</table>
<div class="section level3">
<h3 id="ev_variables---the-data-request">
<code>ev_variables</code> - the data request<a class="anchor" aria-label="anchor" href="#ev_variables---the-data-request"></a>
</h3>
<table class="table">
<colgroup>
<col width="10%">
<col width="10%">
<col width="55%">
<col width="24%">
</colgroup>
<thead><tr class="header">
<th></th>
<th></th>
<th>description</th>
<th>retrieve using</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>ev_variables</code></td>
<td><code>variables</code></td>
<td>A vector containing fully qualified variable names. This is the
basis of the data request.</td>
<td><a href="https://borninbradford.github.io/epivaultr/reference/get_ev_variables.html"><code>get_ev_variables()</code></a></td>
</tr>
<tr class="even">
<td></td>
<td><code>projects</code></td>
<td>A vector of names of the projects containing the requested
variables.</td>
<td><a href="https://borninbradford.github.io/epivaultr/reference/get_ev_projects.html"><code>get_ev_projects()</code></a></td>
</tr>
<tr class="odd">
<td></td>
<td><code>tables</code></td>
<td>A vector of names of the tables containing the requested
variables.</td>
<td><a href="https://borninbradford.github.io/epivaultr/reference/get_ev_tables.html"><code>get_ev_tables()</code></a></td>
</tr>
<tr class="even">
<td></td>
<td><code>vars_df</code></td>
<td>A data frame constructed from the above information, with columns
containing the fully qualified variable name, project name, table name
and variable name for each variable requested.</td>
<td><a href="https://borninbradford.github.io/epivaultr/reference/get_ev_vars_df.html"><code>get_ev_vars_df()</code></a></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="ev_data---the-data-extract">
<code>ev_data</code> - the data extract<a class="anchor" aria-label="anchor" href="#ev_data---the-data-extract"></a>
</h3>
<table class="table">
<colgroup>
<col width="10%">
<col width="10%">
<col width="55%">
<col width="24%">
</colgroup>
<thead><tr class="header">
<th></th>
<th></th>
<th>description</th>
<th>retrieve using</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>ev_data</code></td>
<td><code>data</code></td>
<td>A list of data frames, one per table returned by the data
request.</td>
<td><a href="https://borninbradford.github.io/epivaultr/reference/get_ev_data.html"><code>get_ev_data()</code></a></td>
</tr>
<tr class="even">
<td></td>
<td><code>metadata</code></td>
<td>A list of three data frames containing metadata about the data
returned: <code>variable</code> contains variable-level metadata for all
variables; <code>category</code> contains value labels used by all the
categorical variables in the request; <code>table</code> contains
metadata about all the tables used in the request.</td>
<td><a href="https://borninbradford.github.io/epivaultr/reference/get_ev_metadata.html"><code>get_ev_metadata()</code></a></td>
</tr>
<tr class="odd">
<td></td>
<td><code>request</code></td>
<td>A copy of the <code>ev_variables</code> container used for the data
request.</td>
<td><a href="https://borninbradford.github.io/epivaultr/reference/get_ev_request.html"><code>get_ev_request()</code></a></td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="a-note-on-get_-functions">A note on <code>get_</code> functions<a class="anchor" aria-label="anchor" href="#a-note-on-get_-functions"></a>
</h3>
<p>As the containers are just lists objects, you can access the contents
directly using <code>$</code> notation. However, use of the <a href="https://borninbradford.github.io/epivaultr/reference/index.html#get-data-from-containers"><code>get_</code></a>
functions wherever possible is recommended, as this will be more robust
to any future changes in the internal structure of the containers.</p>
<p>For example, say we have an <a href="https://borninbradford.github.io/epivaultr/articles/features-concepts.html#ev_data---the-data-extract"><code>ev_data</code></a>
container called <code>data_request</code> that contains a data frame
called <code>proj1.tab1</code>. We can access this and assign it to a
data frame called <code>dat</code> in two ways:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># using the get_ function - recommended, won't break in future</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_ev_data.html">get_ev_data</a></span><span class="op">(</span><span class="va">data_request</span>, df_name <span class="op">=</span> <span class="st">"proj1.tab1"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># does the same thing - but not recommended, may break in future</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">data_request</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">proj1.tab1</span></span></code></pre></div>
<p>If the internal structure of the containers changes in future, the
implementation of the associated <a href="https://borninbradford.github.io/epivaultr/reference/index.html#get-data-from-containers"><code>get_</code></a>
functions will change in parallel, so previous code that uses these
should still run OK. But any code that addresses the container elements
directly using <code>$</code> notation may break.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Dan Mason.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
